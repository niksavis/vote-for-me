<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vote - Vote For Me</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="/static/css/shared-styles.css" rel="stylesheet">
    <style>
        /* Vote-specific styles that extend shared components */
        .voting-container {
            max-width: 100%;
            margin: 0 auto;
        }
        
        .vote-item {
            border: 2px solid #e9ecef;
            border-radius: 12px;
            transition: all 0.3s ease;
            min-height: 100px;
            background: white;
            margin-bottom: 1rem;
        }
        
        .vote-item:hover {
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.2);
        }
        
        .vote-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: nowrap;
        }
        
        .vote-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        
        .vote-btn:hover {
            transform: scale(1.1);
        }
        
        .vote-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .vote-btn.plus {
            background: #28a745;
            color: white;
        }
        
        .vote-btn.minus {
            background: #dc3545;
            color: white;
        }
        
        .vote-count {
            min-width: 60px;
            text-align: center;
            font-size: 1.2rem;
            font-weight: bold;
            padding: 8px 16px;
            background: #f8f9fa;
            border-radius: 20px;
            flex-shrink: 0;
        }
        
        .vote-counter {
            position: sticky;
            top: 20px;
            z-index: 100;
        }
        
        /* Responsive adjustments */
        @media (max-width: 991.98px) {
            .vote-counter {
                position: static;
                margin-bottom: 2rem;
            }
            
            body {
                padding-bottom: 120px;
            }
            
            .submit-section {
                padding: 1rem 0.5rem;
            }
            
            .vote-controls {
                justify-content: center;
                margin-top: 1rem;
            }
        }
        
        @media (max-width: 576px) {
            .voting-container {
                padding: 0 0.5rem;
            }
            
            .vote-item {
                margin-bottom: 0.5rem;
            }
            
            .vote-btn {
                width: 35px;
                height: 35px;
                font-size: 0.9rem;
            }
            
            .vote-count {
                min-width: 50px;
                font-size: 1rem;
                padding: 6px 12px;
            }
            
            .progress-ring {
                width: 100px;
                height: 100px;
            }
            
            .progress-container {
                width: 100px;
                height: 100px;
                margin-bottom: 1rem;
            }
            
            body {
                padding-bottom: 140px;
            }
        }
        
        .progress-ring {
            width: 120px;
            height: 120px;
            display: block;
        }
        
        .progress-ring circle {
            fill: transparent;
            stroke: #e9ecef;
            stroke-width: 6;
        }
        
        .progress-ring .progress {
            stroke: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            stroke: #667eea;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.3s ease;
            filter: drop-shadow(0 2px 4px rgba(102, 126, 234, 0.3));
        }
        
        .progress-container {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0 auto 1.5rem auto;
        }
        
        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }
        
        .vote-stats {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        
        .stat-item:last-child {
            border-bottom: none;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
            font-weight: 500;
        }
        
        .stat-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #495057;
        }
        
        .submit-section {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #dee2e6;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            padding: 1rem 0;
        }
        
        .btn-submit {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            font-weight: 600;
            color: white;
        }
        
        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
            color: white;
        }
        
        .btn-submit:disabled {
            background: #6c757d;
            transform: none;
            box-shadow: none;
        }
        
        .session-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            margin-bottom: 2rem;
        }
        
        /* Ensure proper text wrapping */
        .vote-item h6 {
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .vote-item p {
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
    </style>
</head>
<body class="bg-light">
    <!-- Mobile-First Navigation Pane -->
    <nav class="nav-pane" id="navigation">
        <div class="nav-container">
            <a href="/" class="nav-brand">
                <i class="fas fa-vote-yea me-2"></i>
                Vote For Me
            </a>
            
            <button class="nav-toggle" onclick="toggleMobileNav()" aria-label="Toggle navigation">
                <i class="fas fa-bars"></i>
            </button>
            
            <div class="nav-links" id="nav-links">
                <a href="/" class="btn-nav">
                    <i class="fas fa-home me-1"></i>
                    Home
                </a>
                <a href="/admin" class="btn-nav">
                    <i class="fas fa-tachometer-alt me-1"></i>
                    Admin
                </a>
                <a href="/config" class="btn-nav">
                    <i class="fas fa-cog me-1"></i>
                    Config
                </a>
            </div>
        </div>
    </nav>

    <!-- Session Header -->
    <div class="container" style="margin-top: 100px;">
        <div class="voting-container">
            <div class="session-header p-4 text-center">
                <h2 class="mb-2" id="sessionTitle">Loading Session...</h2>
                <p class="mb-0" id="sessionDescription">Please wait while we load your voting session.</p>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <!-- Vote Counter Sidebar (shows first on mobile) -->
            <div class="col-lg-4 order-lg-2">
                <div class="vote-counter">
                    <div class="card">
                        <div class="card-header text-center">
                            <h5 class="mb-0">
                                <i class="fas fa-vote-yea me-2"></i>Your Votes
                            </h5>
                        </div>
                        <div class="card-body text-center">
                            <!-- Progress Ring -->
                            <div class="progress-container">
                                <svg class="progress-ring">
                                    <circle cx="60" cy="60" r="54"></circle>
                                    <circle cx="60" cy="60" r="54" class="progress" 
                                            stroke-dasharray="339" stroke-dashoffset="339"></circle>
                                </svg>
                                <div class="progress-text">
                                    <div class="h2 mb-0" id="remainingVotes">10</div>
                                    <small class="text-muted fw-bold">LEFT</small>
                                </div>
                            </div>
                            
                            <!-- Voting Statistics -->
                            <div class="vote-stats">
                                <div class="stat-item">
                                    <span class="stat-label">
                                        <i class="fas fa-check-circle text-success me-1"></i>
                                        Votes Used
                                    </span>
                                    <span class="stat-value" id="usedVotes">0</span>
                                </div>
                                <div class="stat-item">
                                    <span class="stat-label">
                                        <i class="fas fa-vote-yea text-primary me-1"></i>
                                        Total Votes
                                    </span>
                                    <span class="stat-value" id="totalVotes">10</span>
                                </div>
                            </div>
                            
                            <div class="text-center">
                                <h6 class="text-primary mb-2">
                                    <i class="fas fa-hand-pointer me-1"></i>
                                    How to Vote
                                </h6>
                                <p class="text-muted small mb-0">Use the <strong>+</strong> and <strong>âˆ’</strong> buttons to allocate your votes to different options.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Voting Items -->
            <div class="col-lg-8 order-lg-1">
                <div class="voting-container">
                    <div id="votingItems" class="row g-3">
                        <!-- Loading placeholder -->
                        <div class="col-12 text-center py-5">
                            <i class="fas fa-spinner fa-spin fa-3x text-muted"></i>
                            <h5 class="mt-3">Loading voting items...</h5>
                            <p class="text-muted">Please wait while we prepare your voting session.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Submit Section -->
    <div class="submit-section p-3 mt-4">
        <div class="container">
            <div class="voting-container">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <span class="text-muted">
                            <span id="usedVotesFooter">0</span> of <span id="totalVotesFooter">10</span> votes used
                        </span>
                    </div>
                    <div>
                        <button class="btn btn-outline-secondary me-2" onclick="resetVotes()">
                            <i class="fas fa-undo me-1"></i>Reset
                        </button>
                        <button class="btn btn-submit" id="submitVotesBtn" onclick="submitVotes()" disabled>
                            <i class="fas fa-check me-2"></i>Submit Votes
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal fade" id="successModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center py-4">
                    <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                    <h4>Votes Submitted!</h4>
                    <p class="text-muted">Thank you for participating. Your votes have been recorded.</p>
                    <button class="btn btn-primary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <script src="/static/js/shared.js"></script>
    
    <script>
        // Mobile navigation toggle
        function toggleMobileNav() {
            const navLinks = document.getElementById('nav-links');
            const navToggle = document.querySelector('.nav-toggle i');
            
            navLinks.classList.toggle('nav-open');
            
            if (navLinks.classList.contains('nav-open')) {
                navToggle.className = 'fas fa-times';
            } else {
                navToggle.className = 'fas fa-bars';
            }
        }

        // Close mobile nav when clicking outside
        document.addEventListener('click', function(e) {
            const navPane = document.querySelector('.nav-pane');
            const navLinks = document.getElementById('nav-links');
            
            if (!navPane.contains(e.target) && navLinks.classList.contains('nav-open')) {
                navLinks.classList.remove('nav-open');
                document.querySelector('.nav-toggle i').className = 'fas fa-bars';
            }
        });

        // Voting session data
        let sessionData = null;
        let participantData = null;
        let voteAllocations = {};
        let totalVotes = 10;
        let socket = io();
        
        document.addEventListener('DOMContentLoaded', function() {
            loadVotingSession();
        });
        
        async function loadVotingSession() {
            try {
                // Extract encrypted data from URL
                const encryptedData = window.location.pathname.split('/vote/')[1];
                
                if (!encryptedData) {
                    showError('Invalid voting link');
                    return;
                }
                
                // Try to decrypt and load real session data
                const response = await fetch('/api/vote', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        encrypted_data: encryptedData,
                        action: 'validate'
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        sessionData = result.session;
                        participantData = result.participant;
                        totalVotes = sessionData.settings.votes_per_participant;
                        renderSession();
                        return;
                    }
                }
                
                // If we get here, the link is invalid or expired
                showError('Invalid or expired voting link');
                
            } catch (error) {
                console.error('Error loading session:', error);
                showError('Failed to load voting session');
            }
        }
        
        function renderSession() {
            // Update header
            document.getElementById('sessionTitle').textContent = sessionData.title;
            document.getElementById('sessionDescription').textContent = sessionData.description;
            
            // Check if session is completed
            if (sessionData.status === 'completed') {
                showCompletedSession();
                return;
            }
            
            // Check if session is draft (not started yet)
            if (sessionData.status === 'draft') {
                showDraftSession();
                return;
            }
            
            // Update vote counters
            document.getElementById('remainingVotes').textContent = totalVotes;
            document.getElementById('totalVotes').textContent = totalVotes;
            
            // Render voting items
            renderVotingItems();
            
            // Initialize button states
            updateButtonStates();
            
            // Join real-time session
            if (sessionData.id) {
                socket.emit('join_session', { session_id: sessionData.id });
            }
        }
        
        function renderVotingItems() {
            const container = document.getElementById('votingItems');
            const itemsHtml = sessionData.items.map(item => `
                <div class="col-12 col-md-6 col-lg-12 col-xl-6">
                    <div class="vote-item p-3 h-100" data-item-id="${item.id}">
                        <div class="d-flex flex-column h-100">
                            <div class="flex-grow-1 mb-3">
                                <h6 class="fw-bold text-primary">${item.name}</h6>
                                ${item.description ? `<p class="text-muted small mb-0">${item.description}</p>` : ''}
                            </div>
                            
                            <div class="vote-controls d-flex justify-content-center">
                                <button class="vote-btn minus" onclick="removeVote(${item.id})" 
                                        id="minus-${item.id}" disabled>
                                    <i class="fas fa-minus"></i>
                                </button>
                                <div class="vote-count" id="votes-${item.id}">0</div>
                                <button class="vote-btn plus" onclick="addVote(${item.id})" 
                                        id="plus-${item.id}">
                                    <i class="fas fa-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = itemsHtml;
            
            // Initialize vote allocations
            sessionData.items.forEach(item => {
                voteAllocations[item.id] = 0;
            });
        }
        
        function addVote(itemId) {
            const remainingVotes = getRemainingVotes();
            if (remainingVotes <= 0) {
                return; // No votes left
            }
            
            voteAllocations[itemId] = (voteAllocations[itemId] || 0) + 1;
            updateVoteDisplay();
            updateButtonStates();
        }
        
        function removeVote(itemId) {
            if ((voteAllocations[itemId] || 0) <= 0) {
                return; // No votes to remove
            }
            
            voteAllocations[itemId]--;
            updateVoteDisplay();
            updateButtonStates();
        }
        
        function getRemainingVotes() {
            const usedVotes = Object.values(voteAllocations).reduce((sum, votes) => sum + votes, 0);
            return totalVotes - usedVotes;
        }
        
        function updateButtonStates() {
            const remainingVotes = getRemainingVotes();
            
            sessionData.items.forEach(item => {
                const plusBtn = document.getElementById(`plus-${item.id}`);
                const minusBtn = document.getElementById(`minus-${item.id}`);
                const currentVotes = voteAllocations[item.id] || 0;
                
                // Disable plus button if no votes remaining
                plusBtn.disabled = remainingVotes <= 0;
                
                // Disable minus button if no votes allocated to this item
                minusBtn.disabled = currentVotes <= 0;
            });
        }
        
        function updateVoteDisplay() {
            let usedVotes = 0;
            
            // Update individual item counts
            Object.keys(voteAllocations).forEach(itemId => {
                const count = voteAllocations[itemId];
                document.getElementById(`votes-${itemId}`).textContent = count;
                usedVotes += count;
            });
            
            // Update counters
            const remaining = totalVotes - usedVotes;
            document.getElementById('remainingVotes').textContent = remaining;
            
            // Update progress ring
            const progress = (usedVotes / totalVotes) * 100;
            const circumference = 2 * Math.PI * 54; // Updated for new radius
            const offset = circumference - (progress / 100) * circumference;
            document.querySelector('.progress-ring .progress').style.strokeDashoffset = offset;
            
            // Enable/disable submit button
            const submitBtn = document.getElementById('submitVotesBtn');
            if (usedVotes === totalVotes) {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-check me-2"></i>Submit All Votes';
            } else if (usedVotes > 0) {
                submitBtn.disabled = false;
                submitBtn.innerHTML = `<i class="fas fa-check me-2"></i>Submit (${remaining} unused)`;
            } else {
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="fas fa-check me-2"></i>Submit Votes';
            }
        }
        
        function resetVotes() {
            // Reset all allocations
            Object.keys(voteAllocations).forEach(itemId => {
                voteAllocations[itemId] = 0;
            });
            
            // Update display and button states
            updateVoteDisplay();
            updateButtonStates();
        }
        
        async function submitVotes() {
            try {
                // Show loading
                const submitBtn = document.getElementById('submitVotesBtn');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Submitting...';
                submitBtn.disabled = true;
                
                // Extract encrypted data from URL
                const encryptedData = window.location.pathname.split('/vote/')[1];
                
                if (!encryptedData) {
                    showAlert('Invalid voting link', 'danger');
                    return;
                }
                
                // Validate votes before submission
                const totalVotesAllocated = Object.values(voteAllocations).reduce((sum, votes) => sum + votes, 0);
                if (totalVotesAllocated === 0) {
                    showAlert('Please allocate at least one vote before submitting', 'warning');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    return;
                }
                
                if (totalVotesAllocated > sessionData.settings.votes_per_participant) {
                    showAlert(`You can only allocate ${sessionData.settings.votes_per_participant} votes total`, 'danger');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    return;
                }
                
                // Prepare vote data
                const votes = {};
                sessionData.items.forEach(item => {
                    votes[item.id] = voteAllocations[item.id] || 0;
                });
                
                // Submit via API with retry logic
                let submitSuccess = false;
                let retryCount = 0;
                const maxRetries = 3;
                
                while (!submitSuccess && retryCount < maxRetries) {
                    try {
                        const response = await fetch('/api/vote', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                encrypted_data: encryptedData,
                                action: 'submit',
                                votes: votes
                            })
                        });
                        
                        const result = await response.json();
                        
                        if (response.ok && result.success) {
                            submitSuccess = true;
                            
                            // Show success modal
                            const successModal = new bootstrap.Modal(document.getElementById('successModal'));
                            successModal.show();
                            
                            // Disable further voting
                            document.getElementById('votingItems').style.opacity = '0.5';
                            document.getElementById('votePointsPool').innerHTML = '<div class="text-muted small">Votes submitted successfully</div>';
                            submitBtn.innerHTML = '<i class="fas fa-check me-2"></i>Votes Submitted';
                            submitBtn.classList.remove('btn-submit');
                            submitBtn.classList.add('btn-success');
                            
                            // Emit vote via WebSocket for real-time updates
                            if (sessionData.id && typeof socket !== 'undefined') {
                                socket.emit('vote_submitted', {
                                    session_id: sessionData.id,
                                    votes: votes,
                                    participant_id: participantData?.id || 'unknown'
                                });
                            }
                            
                        } else {
                            throw new Error(result.message || result.error || 'Failed to submit votes');
                        }
                        
                    } catch (error) {
                        retryCount++;
                        if (retryCount >= maxRetries) {
                            throw error;
                        }
                        // Wait before retrying
                        await new Promise(resolve => setTimeout(resolve, 1000 * retryCount));
                    }
                }
                
                if (!submitSuccess) {
                    throw new Error('Failed to submit votes after multiple attempts');
                }
                
            } catch (error) {
                console.error('Error submitting votes:', error);
                showAlert('Failed to submit votes. Please try again.', 'danger');
                
                // Show fallback form submission option after multiple failures
                const submitFormBtn = document.getElementById('submitFormBtn');
                if (submitFormBtn) {
                    submitFormBtn.style.display = 'inline-block';
                }
                
            } finally {
                // Reset button state if submission failed
                const submitBtn = document.getElementById('submitVotesBtn');
                if (submitBtn && !submitBtn.innerHTML.includes('check')) {
                    submitBtn.innerHTML = '<i class="fas fa-vote-yea me-2"></i>Submit Votes';
                    submitBtn.disabled = false;
                    submitBtn.classList.remove('btn-success');
                    submitBtn.classList.add('btn-submit');
                }
            }
        }
        
        function submitVotesForm() {
            // Show form submission method after API fails multiple times
            const formHtml = `
                <form method="POST" style="display: none;" id="fallbackForm">
                    ${sessionData.items.map(item => 
                        `<input type="hidden" name="vote_${item.id}" id="form_vote_${item.id}" value="${voteAllocations[item.id] || 0}">`
                    ).join('')}
                </form>
            `;
            
            document.body.insertAdjacentHTML('beforeend', formHtml);
            document.getElementById('fallbackForm').submit();
        }
        
        function showError(message) {
            document.getElementById('votingItems').innerHTML = `
                <div class="col-12 text-center py-5">
                    <i class="fas fa-exclamation-triangle fa-3x text-danger"></i>
                    <h4 class="mt-3 text-danger">${message}</h4>
                    <p class="text-muted">Please check your voting link and try again.</p>
                </div>
            `;
        }
        
        function showAlert(message, type = 'info') {
            const alertHtml = `
                <div class="alert alert-${type} alert-dismissible fade show position-fixed" 
                     style="top: 20px; right: 20px; z-index: 9999;" role="alert">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', alertHtml);
            
            setTimeout(() => {
                const alert = document.querySelector('.alert');
                if (alert) {
                    const bsAlert = new bootstrap.Alert(alert);
                    bsAlert.close();
                }
            }, 5000);
        }
        
        function showCompletedSession() {
            document.getElementById('votingItems').innerHTML = `
                <div class="col-12 text-center py-5">
                    <div class="card border-warning">
                        <div class="card-body">
                            <i class="fas fa-check-circle fa-4x text-success mb-3"></i>
                            <h3 class="text-success">Voting Session Completed</h3>
                            <p class="lead mb-4">This voting session has ended and is no longer accepting votes.</p>
                            <a href="/results/${sessionData.id}" class="btn btn-primary me-3">
                                <i class="fas fa-chart-bar me-2"></i>View Results
                            </a>
                            <a href="/present/${sessionData.id}" class="btn btn-outline-secondary" target="_blank">
                                <i class="fas fa-presentation me-2"></i>Presentation Mode
                            </a>
                        </div>
                    </div>
                </div>
            `;
            
            // Hide vote counter and submit section
            const voteCounter = document.getElementById('voteCounter');
            if (voteCounter) voteCounter.style.display = 'none';
            
            const submitSection = document.getElementById('submitSection');
            if (submitSection) submitSection.style.display = 'none';
        }
        
        function showDraftSession() {
            document.getElementById('votingItems').innerHTML = `
                <div class="col-12 text-center py-5">
                    <div class="card border-warning">
                        <div class="card-body">
                            <i class="fas fa-clock fa-4x text-warning mb-3"></i>
                            <h3 class="text-warning">Session Not Started</h3>
                            <p class="lead mb-4">This voting session hasn't started yet. Please wait for the organizer to begin the session.</p>
                            <button class="btn btn-primary" onclick="location.reload()">
                                <i class="fas fa-refresh me-2"></i>Refresh Page
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            // Hide vote counter and submit section
            const voteCounter = document.getElementById('voteCounter');
            if (voteCounter) voteCounter.style.display = 'none';
            
            const submitSection = document.getElementById('submitSection');
            if (submitSection) submitSection.style.display = 'none';
        }
        
        // Socket.IO event handlers
        socket.on('connect', () => console.log('Connected to voting session'));
        socket.on('vote_update', (data) => {
            console.log('Vote update received:', data);
        });
    </script>
</body>
</html>
